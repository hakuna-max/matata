{{ define "main" }}
<div class="archive-container">
  <h1>Archive</h1>

  <div class="icon-text-container">
    <span class="material-icons">atm</span>

    <!-- 初始化总字数 -->
    {{ $totalWords := 0 }}
    {{ $filteredPages := slice }}

    <!-- 筛选符合条件的文章 -->
    {{ range .Site.RegularPages }}
      {{ $normalizedPath := strings.Replace .File.Path "\\" "/" -1 }}
      {{ if not (or (eq .File.BaseFileName "archive") (strings.HasPrefix $normalizedPath "authors/")) }}
        {{ $filteredPages = $filteredPages | append . }}
        {{ $totalWords = add $totalWords .WordCount }}
      {{ end }}
    {{ end }}

    <!-- 总文章数和字数 -->
    <div class="text-info">
      <p>Articles: {{ len $filteredPages }}</p>
      <p>
        <span>
          <svg
            t="1656737548689"
            class="icon"
            viewBox="0 0 1024 1024"
            version="1.1"
            xmlns="http://www.w3.org/2000/svg"
            p-id="33866"
            width="12"
            height="12"
          >
            <path
              d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z"
              fill="#adb5bd"
              p-id="33867"
            ></path>
          </svg>
        </span>
        Words: {{ $totalWords }}
      </p>
    </div>
  </div>

  <!-- 分页器设置 -->
  {{ $paginator := .Paginate $filteredPages 6 }} <!-- 每页显示6条记录 -->

  {{ $grouped := dict }}

  {{ range $paginator.Pages }}
    {{ $normalizedPath := strings.Replace .File.Path "\\" "/" -1 }}
    {{ if not (or (eq .File.BaseFileName "archive") (strings.HasPrefix $normalizedPath "authors/")) }}
      {{ $key := .Date.Format "2006-01" }}
      {{ $existing := index $grouped $key | default slice }}
      {{ $grouped = merge $grouped (dict $key ($existing | append .)) }}
    {{ end }}
  {{ end }}

  {{ $sortedKeys := slice }}
  {{ range $key, $value := $grouped }}
    {{ $sortedKeys = $sortedKeys | append $key }}
  {{ end }}

  {{ $sortedKeys = sort $sortedKeys }}
  {{ $total := len $sortedKeys }}
  {{ $reversedKeys := slice }}
  {{ range $i := seq $total }}
    {{ $index := sub $total $i }}
    {{ $reversedKeys = $reversedKeys | append (index $sortedKeys $index) }}
  {{ end }}

  {{ range $reversedKeys }}
    {{ $key := . }}
    {{ $pages := index $grouped $key }}
    {{ $year := substr $key 0 4 }}
    {{ $month := substr $key 5 2 }}
    <h2>{{ $year }} 年 {{ $month }} 月</h2>
    <ul>
      {{ range $pages }}
        {{ $normalizedPath := strings.Replace .File.Path "\\" "/" -1 }}
        {{ if not (or (eq .File.BaseFileName "archive") (strings.HasPrefix $normalizedPath "authors/")) }}
          <li>
            <a href="{{ .RelPermalink }}">
              {{ .Date.Format "2006-01-02" }} {{ .Title }}
            </a>
          </li>
        {{ end }}
      {{ end }}
    </ul>
  {{ end }}

  <!-- 分页导航 -->
  {{ if gt $paginator.TotalPages 1 }}
    <div class="pagination">
      <!-- 首页 -->
      {{ if $paginator.HasPrev }}
      <a href="{{ (index $paginator.Pagers 0).URL }}" aria-label="首页">
        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#5f6368"><path d="M240-240v-480h80v480h-80Zm440 0L440-480l240-240 56 56-184 184 184 184-56 56Z"/></svg>
      </a>
      {{ end }}

      <!-- 上一页 -->
      {{ if $paginator.HasPrev }}
        <a href="{{ $paginator.Prev.URL }}" aria-label="上一页">
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#5f6368"><path d="M560-240 320-480l240-240 56 56-184 184 184 184-56 56Z"/></svg>
        </a>
      {{ end }}

      <!-- 页码 -->
      {{ range $paginator.Pagers }}
        {{ if eq . $paginator }}
          <strong>{{ .PageNumber }}</strong>
        {{ else }}
          <a href="{{ .URL }}">{{ .PageNumber }}</a>
        {{ end }}
      {{ end }}

      <!-- 下一页 -->
      {{ if $paginator.HasNext }}
        <a href="{{ $paginator.Next.URL }}" aria-label="下一页">
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#5f6368"><path d="M504-480 320-664l56-56 240 240-240 240-56-56 184-184Z"/></svg>
        </a>
      {{ end }}

      <!-- 尾页 -->
      {{ if $paginator.HasNext }}
      <a href="{{ (index $paginator.Pagers (sub $paginator.TotalPages 1)).URL }}" aria-label="尾页">
        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#5f6368"><path d="m280-240-56-56 184-184-184-184 56-56 240 240-240 240Zm360 0v-480h80v480h-80Z"/></svg>
      </a>
      {{ end }}
    </div>
  {{ end }}
</div>
{{ end }}
